!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["appsync-nodejs"]=t():e["appsync-nodejs"]=t()}(global,(function(){return(()=>{"use strict";var e={203:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.APIClass=void 0;const o=r(386);class n{constructor(){this._config=null,this._graphqlApi=null,this._graphqlApi=new o.GraphQLAPIClass}configure(e){if(!this._graphqlApi)throw new Error("Missing instance of GraphQLAPI");this._config=e,this._graphqlApi.configure(e)}graphql(e){if(!this._graphqlApi)throw new Error("Missing instance of GraphQLAPI");return console.log("GOT A REQUEST"),this._graphqlApi.graphql(e)}}t.APIClass=n;const i=new n;t.default=i},386:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GraphQLAPIClass=t.graphqlOperation=void 0;const o=r(721),n=r(728),i=r(170);t.graphqlOperation=(e,t={})=>({query:e,variables:t}),t.GraphQLAPIClass=class{constructor(){this._config=null,this._restClient=null,this._restClient=new i.RestClient}configure(e){var t;this._config=e,null===(t=this._restClient)||void 0===t||t.configure(e)}graphql({query:e,variables:t={}}){const r=n.parse(e),[o={}]=r.definitions.filter((e=>"OperationDefinition"===e.kind)),{operation:i}=o;switch(i){case"query":case"mutation":return console.log("PROCESSING REQUEST",i),this._graphql({query:e,variables:t})}throw new Error(`invalid operation type: ${i}`)}async _graphql({query:e,variables:t}){if(!this._config)throw new Error("API has not been configured");if(!this._restClient)throw new Error("Rest Client was not properly configured");const{aws_appsync_graphqlEndpoint:r,aws_appsync_region:n,aws_appsync_apiKey:i}=this._config;if(!r)throw{data:{},errors:[new o.GraphQLError("No graphql endpoint provided.")]};let s,a={body:{},headers:{}};a.body={query:e,variables:t},i&&(a.headers["x-api-key"]=i);try{console.log("INITIATING REQUEST"),s=await this._restClient.post(r,a),console.log("gqlres",s)}catch(e){s={data:{},errors:[new o.GraphQLError(e.message)]}}const{errors:l}=s;if(l&&l.length)throw s;return s}}},170:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&o(t,e,r);return n(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RestClient=void 0;const a=i(r(480)),l=s(r(376));t.RestClient=class{constructor(){this._config=null}configure(e){this._config=e}get(e,t){return this._ajax(e,"GET",t)}put(e,t){return this._ajax(e,"PUT",t)}patch(e,t){return this._ajax(e,"PATCH",t)}post(e,t){return console.log("GOT A POST REQUEST"),this._ajax(e,"POST",t)}del(e,t){return this._ajax(e,"DELETE",t)}head(e,t){return this._ajax(e,"HEAD",t)}async _ajax(e,t,r){if(console.log("AJAX"),!this._config)throw new Error("RestClient was not properly configured: null config");const{aws_appsync_region:o}=this._config;if(!o)throw new Error("RestClient was not properly configured: missing region");let n={method:t,url:e,headers:{},data:null,responseType:"json",timeout:0},i={};const{host:s,path:a}=this._parseUrl(e);if(i.host=s,i.path=a,r.body&&(i["Content-Type"]="application/json; charset=UTF-8",n.data=JSON.stringify(r.body)),void 0===r.headers.Authorization){const t=this._getCreds(e,r);i={...i,...t}}return n.headers={...i,...r.headers},console.log("SENDING REQUEST"),this._request(n)}_getCreds(e,t){if(!this._config)throw new Error("RestClient was not properly configured: null config");const{aws_appsync_region:r}=this._config;if(!r)throw new Error("RestClient was not properly configured: missing region");let o=new a.default.HttpRequest(new a.Endpoint(e),r);const{host:n,path:i}=this._parseUrl(e);return o.headers.host=n,o.headers.path=i,t.body&&(o.body=JSON.stringify(t.body)),new a.default.Signers.V4(o,"appsync",!0).addAuthorization(a.default.config.credentials,a.default.util.date.getDate()),o.headers}_request(e){return l.default(e).then((e=>e.data)).catch((e=>{throw console.error(e),e}))}_parseUrl(e){const t=e.split("/");return{host:t[2],path:"/"+t.slice(3).join("/")}}}},607:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(r(203));n(r(230),t),t.default=s.default},230:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.GRAPHQL_AUTH_MODE=void 0,(r=t.GRAPHQL_AUTH_MODE||(t.GRAPHQL_AUTH_MODE={})).API_KEY="API_KEY",r.AWS_IAM="AWS_IAM",r.AMAZON_COGNITO_USER_POOLS="AMAZON_COGNITO_USER_POOLS"},480:e=>{e.exports=require("aws-sdk")},376:e=>{e.exports=require("axios")},721:e=>{e.exports=require("graphql/error/GraphQLError")},728:e=>{e.exports=require("graphql/language/parser")}},t={};return function r(o){if(t[o])return t[o].exports;var n=t[o]={exports:{}};return e[o].call(n.exports,n,n.exports,r),n.exports}(607)})()}));